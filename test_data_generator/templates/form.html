<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Data Generator</title>
    <style>
        .container {
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 10px;
            min-width: 0;
            word-wrap: break-word;
            background-color: #fff;
            background-clip: border-box;
            border: 0px solid rgba(0, 0, 0, 0);
            border-radius: .25rem;
            margin-top: 0.4rem;
            margin-bottom: 0.4rem;
            box-shadow: 0 2px 6px 0 rgb(218 218 253 / 65%), 0 2px 6px 0 rgb(206 206 238 / 54%);
        }

        .container table {
            width: 100%;
            font-size: 14px;
        }

        .reset{
            position: relative;
            display: flex;
            flex-direction: column;
            padding-right: 10%;
            padding-bottom: 0%;
            padding-top: 20px;
            min-width: 0;
            word-wrap: break-word;
            background-color: #fff;
            border-radius: .25rem;
            margin-bottom: .5rem;
        }

        .btn-circle {
            width: 30px;
            height: 30px;
            padding: 6px 0px;
            border-radius: 15px;
            text-align: center;
            font-size: 12px;
            line-height: 1.42857;
        }

        .nav-link {
            font-family: 'Roboto Slab', sans-serif;
            font-size: 16px;
            margin-right: 20px;
        }

        .nav-link.active {
            background-color: #bfbf9d;
            color: #000;
            border-radius: 10px;
            font-weight: 250;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Style for the copyright container */
        .copyright-container {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #4a1068;
        color: #fff;
        text-align: center;
        }

        /* Style for the scrolling text */
        .copyright-text {
        overflow: hidden; /* Hide overflowing content */
        white-space: nowrap; /* Prevent text wrapping */
        font-family: Calibri, sans-serif;
        animation: scrollText 20s linear infinite; /* Scroll animation */
        }

        /* Keyframes for the scrolling animation */
        @keyframes scrollText {
        0% {
            transform: translateX(100%);
        }
        100% {
            transform: translateX(-100%);
        }
        }
    </style>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Cursive font import -->
    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <!-- jQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Bootstrap JS CDN -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" aria-current="page" href="{{ url_for('usermanual') }}">User Manual</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="{{ url_for('form') }}">Metadata Upload</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" aria-current="page" href="{{ url_for('download') }}">CSV Download</a>
            </li>
            {% if miscellaneous_dict['does_log_exist'] %}
            <li class="nav-item">
                <a class="nav-link" aria-current="page" href="{{ url_for('log') }}">Check Log</a>
            </li>
            {%endif%}
            </ul>
        </div>
        </div>
    </nav>
    <div class="reset" align="right">
        <form id="applyAllRel" action="{{url_for('form')}}" method="POST">
            <button type="submit" class="btn btn-success" name = "applyAll" value = "applyAllRelation">Apply All Relations</button>
            <button type="submit" class="btn btn-danger" name = "resetIndex" value = "ResetIndex">Reset Index</button>
            <button type="submit" class="btn btn-danger" name = "resetAll" value = "ResetAll">Delete All</button>
        </form>
    </div>
    <div class="container">
        <!--This section lets user to input a table name and upload the corresponding metadata-->
        <form id='testDataGen' action="{{ url_for("form")}}" method="post" enctype="multipart/form-data">
            <div class="row form">
                <div class="col-12" style="font-family: 'Roboto Slab', sans-serif; font-size: 18px; font-weight: bold; color: #780d85;">
                    User Input
                </div>
            </div>
            <hr>
            <div class="row form">
                <div class="col-4 form">
                    <div class="mb-3">
                        <input type="text" maxlength="100" name="inputTable" class="form-control" id="idTable" placeholder="Table Name" required>
                    </div>
                </div>
                <div class="col-4 form">
                    <div class="mb-3">
                        <input type="file" name="file" accept=".csv" class="form-control" id="idFile" placeholder="Metadata" required>
                    </div>
                </div>
                <div class="col-4 form">
                    <div class="mb-3">
                        <input type="number" min="0" step="1" name="number" class="form-control" id="idNumber" placeholder="Number of Records" required>
                    </div>
                </div>
            </div>
            <div class="row form">
                {% if table_details_dict["table_metadata"]|length > 1 %}
                <div class="col-6 form">
                    <div class="mb-3" align = "right">
                        <button type="submit" id='genCSV' class="btn btn-success" name = "generateCSV" value = "Generate CSV">Generate Test Data</button>
                    </div>
                </div>
                {% else %}
                <div class="col-12 form">
                    <div class="mb-3" align = "center">
                        <button type="submit" id='genCSV' class="btn btn-success" name = "generateCSV" value = "Generate CSV">Generate Test Data</button>
                    </div>
                </div>
                {% endif %}
        </form>
        <form action="{{ url_for("form")}}" method="post">
                {% if table_details_dict["table_metadata"]|length > 1 %}
                <div class="col-6 form" align = "left">
                    <div class="mb-3">
                        <button type="submit" class="btn btn-primary" name = "chooseRelation" value = "Define Relation">Define Key Relation</button>
                    </div>
                </div>
                {% endif %}
            </div>
        </form>
        <div class="row form">
            <div class="col-12 form">
                {% if success_message %}
                <div class="mb-3" style="margin-top: 20px; background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; padding: 10px;">
                    {{ success_message }}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% if table_details_dict and table_details_dict["table_metadata"]|length > 1 and miscellaneous_dict and ('Define Relation' in miscellaneous_dict) %}
    <hr>
    <div class="container">
        <!--This section lets user to choose a primary table amongst all the different tables'metadata provided-->
        <form action="{{ url_for("form")}}" method="post">
            <div class="row form">
                <div class="col-12" style="font-family: 'Roboto Slab', sans-serif; font-size: 18px; font-weight: bold; color: #780d85;">
                    Define Primary Key
                </div>
            </div>
            <hr>
            <div class="row form">
            <div class="col-6 form-group">
                <select class="form-control" id="tableSelect" name="getTable" required>
                    <option disabled selected>
                        {% if key_combo_dict and key_combo_dict['key_combo']|length > 0 and key_combo_dict['key_combo'][key_combo_dict['key_combo']|length - 1]['primary_table_name'] %}
                        {{ key_combo_dict['key_combo'][key_combo_dict['key_combo']|length - 1]['primary_table_name'] }}
                        {% else %}
                        Select a Table
                        {% endif %}
                    </option>
                    {% for metadata in table_details_dict["table_metadata"] %}
                    <option>{{ metadata["table_name"] }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-5 form">
                <button type="submit" class="btn btn-warning" name = "getColumns" value = "Get Columns">Get Columns</button>
            </div>
            </div>
        </form>
        <!-- This section lets user to choose a column name from the chosen primary table, for assigning primary key-->
        <form action="{{ url_for("form")}}" method="post">
            <!--{{ key_combo_dict }}-->
            {% if key_combo_dict["key_combo"]|length > 0 %}
            <div class="row form">
                <div class="col-6 form-group">
                    <select class="form-control" id="columnSelect" name="getColumn" required>
                        <option disabled selected>
                            {% if key_combo_dict.keys()|length > 0 and key_combo_dict['key_combo'][key_combo_dict['key_combo']|length - 1]['primary_column_name'] %}
                            {{ key_combo_dict['key_combo'][key_combo_dict['key_combo']|length - 1]['primary_column_name'] }}
                            {% else %}
                            Select a Column
                            {% endif %}
                        </option>
                        {% for column_name in table_details_dict["table_metadata"][index_dict['pindex']]["list_of_columns"] %}
                        <option>{{ column_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-5 form">
                    <button type="submit" class="btn btn-info" name = "primarySelection" value = "Finalize Primary Key">Finalize Primary Key</button>
                </div>
            </div>
            {% endif %}
        </form>
    </div>
    {% endif %}
    {% if key_combo_dict and key_combo_dict.keys()|length > 0 and key_combo_dict['key_combo']|length > 0 and key_combo_dict['key_combo'][key_combo_dict['key_combo']|length - 1]['primary_column_name'] %}
    <hr>
    <div class="container">
        <!--This section lets user to choose a secondary table amongst the list of tables-->
        <form action="{{ url_for("form")}}" method="post">
            <div class="row form">
                <div class="col-12" style="font-family: 'Roboto Slab', sans-serif; font-size: 18px; font-weight: bold; color: #780d85;">
                    Define Foreign Key
                </div>
            </div>
            <hr>
            <div class="row form">
            <div class="col-6 form-group">
                <select class="form-control" id="ftableSelect" name="getFTable" required>
                    <option disabled selected>
                        {% if key_combo_dict.keys()|length > 0 and key_combo_dict['key_combo'][key_combo_dict['key_combo']|length - 1]['foreign_table_name'] %}
                        {{ key_combo_dict['key_combo'][key_combo_dict['key_combo']|length - 1]['foreign_table_name'] }}
                        {% else %}
                        Select a Table
                        {% endif %}
                    </option>
                    
                    {% for metadata in table_details_dict["table_metadata"] %}
                    {% if metadata["table_name"] != key_combo_dict['key_combo'][key_combo_dict['key_combo']|length - 1]['primary_table_name'] %}
                    <option>{{ metadata["table_name"] }}</option>
                    {% endif %}
                    {% endfor %}
                </select>
            </div>
            <div class="col-5 form">
                <button type="submit" class="btn btn-warning" name = "getFColumns" value = "Get FColumns">Get Columns</button>
            </div>
            </div>
        </form>
        <!-- This section lets user to choose a column name from the chosen foreign table, for assigning foreign key-->
        {% if key_combo_dict['key_combo'][key_combo_dict['key_combo']|length - 1]['foreign_table_name'] %}
        <form action="{{ url_for("form")}}" method="post">
            <!--{{ key_combo_dict }}-->
            {% if key_combo_dict["key_combo"]|length > 0 %}
            <div class="row form">
                <div class="col-6 form-group">
                    <select class="form-control" id="columnFSelect" name="getFColumn" required>
                        <option disabled selected>
                            {% if key_combo_dict.keys()|length > 0 and key_combo_dict['key_combo'][key_combo_dict['key_combo']|length - 1]['foreign_column_name'] %}
                            {{ key_combo_dict['key_combo'][key_combo_dict['key_combo']|length - 1]['foreign_column_name'] }}
                            {% else %}
                            Select a Column
                            {% endif %}
                        </option>
                        {% for column_name in table_details_dict["table_metadata"][index_dict['findex']]["list_of_columns"] %}
                        <option>{{ column_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-5 form">
                    <button type="submit" class="btn btn-info" name = "foreignSelection" value = "Finalize Foreign Key">Finalize Foreign Key</button>
                </div>
            </div>
            {% endif %}
        </form>
        {% endif %}
    </div>
    {% endif %}

    {% if key_combo_dict %}
    <hr>
    <!--sdnlksd;ad;ad';ald';asd';ks;aldjaslkfksdflkdwfnlasknclkasmdasdnlkadmasfndkjhfwjkdbfjdvlsamc;af-->
    <div class="container">
        <div>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th scope="col">Serial No</th>
                    <th scope="col">Primary Table</th>
                    <th scope="col">Primary Key</th>
                    <th scope="col">Join Table</th>
                    <th scope="col" colspan="2">Foreign Key</th>
                </tr>
                </thead>
                <tbody>
                {% for item in key_combo_dict["key_combo"] %}
                <tr>
                    <td class="no">{{ item['Serial_No'] }}</td>
                    <td class="ptable">{{ item['primary_table_name'] }}</td>
                    <td class="pcol">{{ item['primary_column_name'] }}</td>
                    <td class="ftable">{{ item['foreign_table_name'] }}</td>
                    <td class="fcol">{{ item['foreign_column_name'] }}</td>
                    <form action="{{url_for('form')}}" method="POST">
                    <td class="dlt_btn" align="right"><button type="submit" class="btn btn-danger btn-circle btn-sm" name = "delete{{item['Serial_No']}}" value = "Delete{{item['Serial_No']}}">-</button></td>
                    </form>
                </tr>
                {% endfor %}
                </tbody>
              </table>
        
        </div>
    </div>
    {% endif %}

    <!-- Loading modal for Test Data Generation -->
    <div class="modal" id="loadingModal" tabindex="-1" role="dialog" aria-labelledby="loadingModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="text-center">
                        <div class="spinner-border text-success" role="status">
                            <span class="sr-only" style="font-family: 'Lobster', cursive; font-size: 20px;">Generating Test Data...</span>
                        </div>
                        <p class="mt-2" style="font-family: 'Lobster', cursive; font-size: 20px;">Generating Test Data...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading modal for Applying Relations-->
    <div class="modal" id="loadingModalRel" tabindex="-1" role="dialog" aria-labelledby="loadingModalRelLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="text-center">
                        <div class="spinner-border text-info" role="status">
                            <span class="sr-only" style="font-family: 'Lobster', cursive; font-size: 20px;">Processing...</span>
                        </div>
                        <p class="mt-2" style="font-family: 'Lobster', cursive; font-size: 20px;">Processing...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="copyright-container">
        <div class="copyright-text">
          Created by Arka Saha (anticlock909@gmail.com). &copy; 2025. All rights reserved.
        </div>
    </div>

    <script>
        // Function to show the loading modal
        function showLoadingModal() {
            $('#loadingModal').modal('show'); // Show the modal using jQuery and Bootstrap's modal method
        }
    
        // Function to hide the loading modal
        function hideLoadingModal() {
            $('#loadingModal').modal('hide'); // Hide the modal using jQuery and Bootstrap's modal method
        }
    
        // Example: Add event listener to a form submission
        document.getElementById('testDataGen').addEventListener('submit', function() {
            showLoadingModal(); // Show loading modal when form is submitted
            // Perform your form submission or other actions here...
        });

        // Function to show the loading modal
        function showLoadingModalRel() {
            $('#loadingModalRel').modal('show'); // Show the modal using jQuery and Bootstrap's modal method
        }
    
        // Function to hide the loading modal
        function hideLoadingModalRel() {
            $('#loadingModalRel').modal('hide'); // Hide the modal using jQuery and Bootstrap's modal method
        }

        // Example: Add event listener to a form submission
        document.getElementById('applyAllRel').addEventListener('submit', function() {
            showLoadingModalRel(); // Show loading modal when form is submitted
            // Perform your form submission or other actions here...
        });
    </script>
</body>
</html>
